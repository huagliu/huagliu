<!DOCTYPE html>



  


<html class="theme-next muse use-motion" lang="zh-Hans">
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="theme-color" content="#222">








<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css">







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="C++基础,">









<script>
    (function () {
        if ('') {
            if (prompt('请输入文章密码') !== '') {
                alert('密码错误！');
                if (history.length === 1) {
                    location.replace("http://xxxxxxx.xxx"); // 这里替换成你的首页
                } else {
                    history.back();
                }
            }
        }
    })();
</script>


<meta name="description" content="编程小白在此整理一些C++基础知识。本文框架：  C++与C语言关系 编译过程 GCC和LLVM Xcode 工程结构 CMake">
<meta name="keywords" content="C++基础">
<meta property="og:type" content="article">
<meta property="og:title" content="C++大补丸1">
<meta property="og:url" content="http://huagliu.github.io/2020/07/24/C++大补丸1/index.html">
<meta property="og:site_name" content="HUAG ZONE">
<meta property="og:description" content="编程小白在此整理一些C++基础知识。本文框架：  C++与C语言关系 编译过程 GCC和LLVM Xcode 工程结构 CMake">
<meta property="og:locale" content="zh-Hans">
<meta property="og:image" content="http://huagliu.github.io/2020/07/24/C++大补丸1/buildProcess.png">
<meta property="og:updated_time" content="2020-08-05T22:45:29.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="C++大补丸1">
<meta name="twitter:description" content="编程小白在此整理一些C++基础知识。本文框架：  C++与C语言关系 编译过程 GCC和LLVM Xcode 工程结构 CMake">
<meta name="twitter:image" content="http://huagliu.github.io/2020/07/24/C++大补丸1/buildProcess.png">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://huagliu.github.io/2020/07/24/C++大补丸1/">





  <title>C++大补丸1 | HUAG ZONE</title>
  




<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
          m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA<%%%%%%%%>', 'auto');
  ga('send', 'pageview');
</script>





</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">HUAG ZONE</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br>
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br>
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br>
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br>
            
            归档
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br>
            
            搜索
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off" placeholder="搜索..." spellcheck="false" type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://huagliu.github.io/2020/07/24/C++大补丸1/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Huag">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="HUAG ZONE">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">C++大补丸1</h1>
        

        <div class="post-meta">
	
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-07-24T17:22:21+08:00">
                2020-07-24
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/C/" itemprop="url" rel="index">
                    <span itemprop="name">C++</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2020/07/24/C++大补丸1/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count gitment-comments-count" data-xid="/2020/07/24/C++大补丸1/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          
          

          
            <span class="post-meta-divider">|</span>
            <span class="page-pv"><i class="fa fa-file-o"></i>
            <span class="busuanzi-value" id="busuanzi_value_page_pv"></span>
            </span>
          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  5.5k
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  19
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <p>编程小白在此整理一些C++基础知识。<br>本文框架：</p>
<ul>
<li>C++与C语言关系</li>
<li>编译过程</li>
<li>GCC和LLVM</li>
<li>Xcode 工程结构</li>
<li>CMake</li>
</ul>
<a id="more"></a>
<h2 id="C-与C语言关系"><a href="#C-与C语言关系" class="headerlink" title="C++与C语言关系"></a>C++与C语言关系</h2><p>顾名思义，C++ 是在C语言的基础上增加新特性。从语法上看，C语言是 C++ 的一部分，C语言代码几乎不用修改就能够以 C++ 的方式编译。</p>
<h3 id="发展历史"><a href="#发展历史" class="headerlink" title="发展历史"></a>发展历史</h3><p>早期并没有“C++”这个名字，而是叫做“带类的C”。“带类的C”是作为C语言的一个扩展和补充出现的，它增加了很多新的语法，目的是提高开发效率。这个时期的 C++ 非常粗糙，仅支持简单的面向对象编程，也没有自己的编译器，而是通过一个预处理程序（名字叫 cfront），先将 C++ 代码”翻译“为C语言代码，再通过C语言编译器合成最终的程序。 随着 C++ 的流行，它的语法也越来越强大，已经能够很完善的支持面向过程编程、面向对象编程（OOP）和泛型编程，几乎成了一门独立的语言，拥有了自己的编译方式。</p>
<p>C与 C++ 在很多平台下有拥有共同的编译器，例如 Windows 下的微软编译器（cl.exe）、Linux 下的 GCC编译器、Mac 下的 Clang 编译器（已经是 Xcode 默认编译器，雄心勃勃，立志超越 GCC），它们都同时支持C语言和 C++，统称为 C/C++ 编译器。对于C语言代码，它们按照C语言的方式来编译；对于 C++ 代码，就按照 C++ 的方式编译。</p>
<h3 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h3><ul>
<li>[1] <a href="http://c.biancheng.net/view/2188.html">C语言中文网</a></li>
</ul>
<h2 id="编译过程"><a href="#编译过程" class="headerlink" title="编译过程"></a>编译过程</h2><p>整个编译过程分为两大步：</p>
<ol>
<li><p>编译 ：编译器对源代码进行编译，把文本形式的源代码翻译成机器语言，并形成目标文件；</p>
</li>
<li><p>连接 ：把目标文件操作系统的启动代码和库文件组织起来形成可执行程序。</p>
</li>
</ol>
<p>在一个 C++ 程序中，常包含两类文件—— .cpp 文件和 .h 文件。其中，.cpp 文件被称作 C++ 源文件；而 .h 文件则被称作 C++ 头文件。</p>
<h3 id="源文件（Source-File）"><a href="#源文件（Source-File）" class="headerlink" title="源文件（Source File）"></a>源文件（Source File）</h3><p>在开发软件的过程中，我们需要将编写好的代码保存到一个文件中，这样代码才不会丢失，才能够被编译器找到，才能最终变成可执行文件。这种用来保存代码的纯文本文件就叫做源文件，它的内部并没有特殊格式。</p>
<ul>
<li>C语言源文件的后缀是<code>.c</code>；</li>
<li>C++语言（C Plus Plus）源文件的后缀是<code>.cpp</code>；</li>
<li>Java源文件的后缀是<code>.java</code>；</li>
<li>Python源文件的后缀是<code>.py</code>；</li>
<li>JavaScript源文件后置是<code>.js</code>。</li>
</ul>
<p>需要注意的是，不同的编译器支持不同的C++ 源文件后缀，<a href="http://c.biancheng.net/view/2191.html">这里</a>进行了简单的汇总。</p>
<h3 id="头文件（Head-File）"><a href="#头文件（Head-File）" class="headerlink" title="头文件（Head File）"></a>头文件（Head File）</h3><p>所谓的头文件，其实它的内容跟 .cpp 文件中的内容是一样的，都是 C++  的源代码。但头文件不用被编译。我们把所有的函数声明全部放进一个头文件中，当某一个 .cpp 源文件需要它们时，它们就可以通过一个宏命令  “#include” 包含进这个 .cpp 文件中，从而把它们的内容合并到 .cpp 文件中去。当 .cpp 文件被编译时，这些被包含进去的  .h 文件的作用便发挥了。应该记住的一点就是，.h头文件中，只能存在变量或者函数的声明，而不要放定义。</p>
<p><strong>.h文件中能包含：</strong></p>
<ul>
<li>类成员数据的声明，但不能赋值 </li>
<li>类静态数据成员的定义和赋值，但不建议，只是个声明就好。 </li>
<li>类的成员函数的声明 </li>
<li>非类成员函数的声明 </li>
<li>常数的定义：如：const int a=5; </li>
<li>静态函数的定义 </li>
<li>类的内联函数（inline）的定义</li>
</ul>
<p><strong>.h文件中不能包含：</strong></p>
<ul>
<li>所有非静态变量（不是类的数据成员）的声明 </li>
<li>默认命名空间声明不要放在头文件，using namespace std;等应放在.cpp中，在 .h 文件中使用 std::string</li>
</ul>
<h3 id="编译"><a href="#编译" class="headerlink" title="编译"></a>编译</h3><p>编译过程细分为三个阶段：预编译—&gt;编译优化—&gt;汇编。</p>
<ol>
<li><p><strong>预编译</strong>：预处理又称为预编译，是做些代码文本替换工作。编译器执行预处理指令（以#开头，例如#include），这个过程会得到不包含#指令的.i文件。这个过程会拷贝#include 包含的文件代码，进行#define 宏定义的替换 ， 处理条件编译指令 （#ifndef #ifdef #endif）等。</p>
</li>
<li><p><strong>编译、优化</strong>：预编译输出的.i文件中，只有常量：数字、字符串、变量的定义，以及c语言的关键字：main、if、else、for、while等。编译程序所要作得工作就是通过词法分析和语法分析，在确认所有的指令都符合语法规则之后，将其翻译成等价的中间代码表示或汇编代码。优化处理是编译系统中一项比较艰深的技术，其工作主要是，通过语法分析和词法分析，确定所有指令是否符合规则。这个过程将.i文件转化位.s文件。</p>
</li>
<li><p><strong>汇编</strong>：汇编过程就是把汇编语言翻译成目标机器指令的过程，生成目标文件（.obj .o等）。目标文件中存放的也就是与源程序等效的目标的机器语言代码。目标文件由段组成，通常至少有两个段：</p>
<ul>
<li><p>代码段：包换主要程序的指令。该段是可读和可执行的，一般不可写。</p>
</li>
<li><p>数据段：存放程序用到的全局变量或静态数据。可读、可写、可执行。</p>
</li>
</ul>
<p>这个过程将.s文件转化成.o文件。</p>
</li>
</ol>
<h3 id="链接（Link）"><a href="#链接（Link）" class="headerlink" title="链接（Link）"></a>链接（Link）</h3><p>C++ 语言支持”分别编译”（separate compilation）。也就是说，一个程序所有的内容，可以分成不同的部分分别放在不同的  .cpp 文件里。.cpp  文件里的东西都是相对独立的，在编译（compile）时不需要与其他文件互通，只需要在编译成目标文件后再与其他的目标文件做一次链接（link）就行了。比如，在文件 a.cpp 中定义了一个全局函数 “void a(){}”，而在文件 b.cpp 中需要调用这个函数。即使这样，文件 a.cpp 和文件  b.cpp 并不需要相互知道对方的存在，而是可以分别地对它们进行编译，编译成目标文件之后再链接，整个程序就可以运行了。</p>
<p>这是怎么实现的呢？从写程序的角度来讲，很简单。在文件 b.cpp 中，在调用 “void a()” 函数之前，先声明一下这个函数  “voida();”，就可以了。这是因为编译器在编译 b.cpp 的时候会生成一个符号表（symbol table），像 “void a()”  这样的看不到定义的符号，就会被存放在这个表中。再进行链接的时候，编译器就会在别的目标文件中去寻找这个符号的定义。一旦找到了，程序也就可以顺利地生成了。链接过程将.o文件转化成可执行的文件（.exe、.elf、.axf等）。</p>
<p>值得注意的是，这里提到了两个概念，一个是”定义”，一个是”声明”。简单地说，”定义”就是把一个符号完完整整地描述出来：它是变量还是函数，返回什么类型，需要什么参数等等。而”声明”则只是声明这个符号的存在，即告诉编译器，这个符号是在其他文件中定义的，我这里先用着，你链接的时候再到别的地方去找找看它到底是什么吧。定义的时候要按 C++  语法完整地定义一个符号（变量或者函数），而声明的时候就只需要写出这个符号的原型了。需要注意的是，一个符号，在整个程序中可以被声明多次，但却要且仅要被定义一次。</p>
<p><img src="/2020/07/24/C++大补丸1/buildProcess.png" alt="buildProcess"></p>
<p><center> 编译与链接过程示意图 <center></center></center></p>
<h3 id="参考-1"><a href="#参考-1" class="headerlink" title="参考"></a>参考</h3><ul>
<li>[1] <a href="http://c.biancheng.net/view/451.html">C语言中文网</a></li>
<li>[2] <a href="https://www.runoob.com/w3cnote/cpp-header.html">菜鸟教程</a></li>
<li>[3] <a href="https://www.cnblogs.com/mickole/articles/3659112.html">[C/C++程序编译过程详解]</a></li>
</ul>
<h2 id="GCC-和-LLVM"><a href="#GCC-和-LLVM" class="headerlink" title="GCC 和 LLVM"></a>GCC 和 LLVM</h2><p> Mac 下，如果你安装了 Xcode ，那么你就拥有了 <strong>LLVM</strong> 和 <strong>GCC</strong> 两大编译工具。</p>
<h3 id="LLVM"><a href="#LLVM" class="headerlink" title="LLVM"></a>LLVM</h3><p><strong>LLVM</strong>，原来叫做 「Low Level Virtual Machine」，该项目的领导者和最初作者是 Chris Lattner 和 Vikram Adve，在 2000年的开始于 伊利诺伊大学厄巴纳-香槟分校（University of Illinois at  Urbana-Champaign），2005年，Apple 雇佣了 Chris Lattner，成立了一个团队专注于 LLVM 系统在  Apple 开发系统上的各种使用。LLVM 目前是 Apple 的 Mac OSX 和 iOS 的开发工具的重要部分。LLVM 项目是一个综合项目（umbrella project），它包括了一系列开发工具相关的技术，如：</p>
<ul>
<li>编译器，Clang，LLVM 原生的 C/C++/Objective-C 编译器，旨在提供一个快速的编译器</li>
<li>调试器，LLDB，在 LLVM 和 Clang 的基础上构建的一个调试器</li>
<li>JIT 系统，VMKit， Java 和 .NET 虚拟机的 LLVM 技术实现</li>
<li>优化器，DragonEgg，集成了 LLVM 的优化器和搭配 GCC 解析工具的代码产生器</li>
<li>……</li>
</ul>
<h3 id="GCC"><a href="#GCC" class="headerlink" title="GCC"></a>GCC</h3><p><strong>GCC</strong>，全称为 GNU Complier Collection，<strong>GCC</strong> 是 GNU Project 的关键组成部分，是由自由软件之父 Richard Stallman 在 1983 年9月27日于麻省理工大学发起的，旨在给一切计算机用户提供自由、可控的计算环境，用户可以自由的运行、分享、学习以及修改软件，即自由软件。</p>
<p><strong>GCC</strong> 最初叫做 GNU C Compiler ，只支持 C 语言的编译，1.0 之后开始支持 C++，再随后支持了 Objective-C，Objective-C++，Fortran，Java，Ada，Go等其他语言。至于选择哪个作为首选，则看具体情况了。GCC 历史悠久，支持较为广泛，且目前许多开源项目都是直接使用 GCC 作为编译器的。当然，Clang 同为开源项目，可以跨平台使用，而 Clang  相对 GCC 的优势： 编译速度快：在某些平台上，Clang 的编译速度显著的快过 GCC。 占用内存小：Clang 生成的 AST  所占用的内存是 GCC 的五分之一左右。 模块化设计：Clang 采用基于库的模块化设计，易于 IDE 集成及其他用途的重用。  诊断信息可读性强：在编译过程中，Clang 创建并保留了大量详细的元数据 (metadata)，有利于调试和错误报告。  设计清晰简单，容易理解，易于扩展增强。与代码基础古老的 GCC 相比，学习曲线平缓。</p>
<h3 id="参考-2"><a href="#参考-2" class="headerlink" title="参考"></a>参考</h3><ul>
<li>[1] <a href="https://www.cnblogs.com/lxlx1798/p/7679697.html">Mac 下的 C++ 开发环境</a></li>
</ul>
<h2 id="Xcode-工程结构"><a href="#Xcode-工程结构" class="headerlink" title="Xcode 工程结构"></a>Xcode 工程结构</h2><h3 id="工程／项目（Project）"><a href="#工程／项目（Project）" class="headerlink" title="工程／项目（Project）"></a>工程／项目（Project）</h3><p>一个真正的程序（也可以说软件）往往包含多项功能，每一项功能都需要几十行甚至几千行、几万行的代码来实现。在实际开发中，程序员都是将这些代码分门别类地放到多个源文件中。除了这些成千上万行的代码，一个程序往往还要包含图片、视频、音频、控件、库（也可以说框架）等其它资源，它们也都是一个一个地文件。</p>
<p>为了有效地管理这些种类繁杂、数目众多的文件，我们有理由把它们都放到一个目录（文件夹）下，并且这个目录下只存放与当前程序有关的资源。实际上 IDE  也是这么做的，它会为每一个程序都创建一个专门的目录，将用到的所有文件都集中到这个目录下，并对它们进行便捷的管理，比如重命名、删除文件、编辑文件等。 这个为当前程序配备的专用文件夹，被称做“Project”。</p>
<h3 id="工程／项目类型"><a href="#工程／项目类型" class="headerlink" title="工程／项目类型"></a>工程／项目类型</h3><p>“程序”是一个比较宽泛的称呼，它可以细分为很多种类，例如： </p>
<ul>
<li><p>有的程序不带界面，完全是“黑屏”的，只能输入一些字符或者命令，称为控制台程序（Console Application），例如 Windows 下的 cmd.exe，Linux 或 Mac OS 下的终端（Terminal）。</p>
</li>
<li><p>有的程序带界面，看起来很漂亮，能够使用鼠标点击，称为GUI程序（Graphical User Interface Program），例如 QQ、Chrome 等。</p>
</li>
<li><p>有的程序不单独出现，而是作为其它程序的一个组成部分，普通用户很难接触到它们，例如静态库、动态库等。</p>
</li>
</ul>
<p>控制台程序是 DOS 时代的产物了，它没有复杂的功能，没有漂亮的界面，只能看到一些文字，虽然枯燥无趣，也不实用，但是它非常简单，不受界面的干扰，所以适合入门。</p>
<p>不同的程序对应不同的工程类型（项目类型），使用 IDE 时必须选择正确的工程类型才能创建出我们想要的程序。换句话说，IDE 包含了多种工程类型，不同的工程类型会创建出不同的程序。不同的工程类型本质上是对 IDE 中各个参数的不同设置；我们也可以创建一个空白的工程类型，然后自己去设置各种参数（不过一般不这样做）。</p>
<h3 id="Scheme、Target、Project-和-Workspace"><a href="#Scheme、Target、Project-和-Workspace" class="headerlink" title="Scheme、Target、Project 和 Workspace"></a>Scheme、Target、Project 和 Workspace</h3><p>Scheme、Target、Project 和 Workspace 是组成一个 Xcode 工程最核心的单元。</p>
<h4 id="Target"><a href="#Target" class="headerlink" title="Target"></a>Target</h4><p>Target 是工程中的<strong>最小可编译单元</strong>，每一个 target 对应一个编译输出，这个输出可以是一个链接库，一个可执行文件或者一个资源包。<strong>它定义了这个输出怎样被 build 的所有细节</strong>，包括：</p>
<ul>
<li>编译选项，比如使用的编译器，目标平台，flag，头文件搜索路径等等。</li>
<li>哪些源码或者资源文件会被编译打包，哪些静态库、动态库会被链接。</li>
<li>build 时的前置依赖、执行的脚本文件。</li>
<li>build 生成目标的签名、Capabilities 等属性。</li>
</ul>
<p>我们平时在 Build Settings，Build Phases 中配置的各种选项，大部分都是对应到指定的 target 的。每次我们在 Xcode 中 run/test/profile/analyze/archive 时，都必须指定一个 target。工程中的 targets 有时候会共享很多代码、资源，这些相似的 targets 可能对应同一个应用的不同版本，比如 iPad 版和 iPhone 版，或者针对不同市场的版本。</p>
<h4 id="Scheme"><a href="#Scheme" class="headerlink" title="Scheme"></a>Scheme</h4><p>当点击Xcode 左上角的 Run 箭头来运行调试代码，这其实就是执行了 Scheme 定义的一个任务。<strong>针对一个指定的 target，scheme 定义了 build 这个 target 时使用的配置选项，执行的任务，环境参数等等</strong>。Scheme 可以理解为一个<strong>工作流</strong>，或者<strong>蓝图</strong>，当我们点击 debug，test 按钮时，Xcode 会按照 scheme 中的定义，去执行对应的工作流。</p>
<p>Scheme 中预设了六个主要的工作流： Build, Run, Test, Profile, Analyze, Archive。包括了我们对某个 target 的所有操作，每一个工作流都可以单独配置。Scheme 中最重要的一个配置是选择 target 的 build configuration，对每一个 project，会有两个默认的 build configuration：debug 和 release。每个 configuration 对应了 build target 时不同的参数集，比如宏，编译器选项，bundle name 等等。我们可以在 target 的配置页中更改这些选择项，也可以自己创建新的 build configuration。除了 build configuration 外，scheme 还可以配置：</p>
<ul>
<li>运行时的环境变量（Environment Variables）</li>
<li>启动时设置给 UserDefaults 的参数（Arguments Passed on Launch）</li>
<li>App 执行时的系统语言、模拟的定位坐标、国家等环境参数</li>
<li>runtime，内存管理，日志，帧率检测等调试选项</li>
</ul>
<p>另外有一些 debug 时十分有用的选项，也可以在 scheme 配置中找到。一个 scheme 对应一个 target，同一个 target 可以有多个 scheme，通过灵活地配置 scheme，我们可以方便地管理不同环境下项目的测试，调试，打包流程。</p>
<h4 id="Project"><a href="#Project" class="headerlink" title="Project"></a>Project</h4><p>Project 很好理解，就是一个 Xcode 工程，它<strong>管理这个工程下的 targets 集合以及它们的源码，引用的资源，framework 等等</strong>。</p>
<p>Project 是管理资源的容器，本身是无法被编译的，所以每个 project 至少应该有一个可编译的 target，否则就是一个空壳。一个 target 编译时引用的资源是它所在 project 所有管理资源的子集。</p>
<p>我们也可以对 project 进行配置，包括基本信息和编译选项（Build Settings）等，这些配置会应用到它管理的所有 targets 中，但是如果 target 有自己的配置，则会覆盖 project 中对应的配置。在很多情况下，我们的工程中只有一个 project。可以在 finder 中双击后缀名为<code>.xcodeproj</code> 的文件，就可以直接打开单个 project 了。</p>
<p>如果我们需要从源码编译一个依赖库，可以把这些源码所在的工程作为主工程的<code>subProject</code> 添加到目录结构中去，然后将这个子工程的某个 target 作为主工程 target 的依赖，从而在 build 主工程 target 的时候，顺便也会编译子工程对应的 target。这样做的好处是你可以在一个窗口中同时修改主工程和子工程的源码，并且一起进行编译。</p>
<h4 id="Workspace"><a href="#Workspace" class="headerlink" title="Workspace"></a>Workspace</h4><p>上面所说的添加子工程的方法，已经很好的解决了不同项目中 target 依赖的问题了，那么什么时候需要用到 Workspace 呢？事实上，当一个 target 被多个不同的项目依赖，或者 project 之间互相引用，那么我们就需要把这些 projects 放到相同的层级上来。<strong>管理相同层级 projects 的容器就是 Workspace</strong>。和 projects，target 不同，workspace 是纯粹的<strong>容器</strong>，不参与任何编译链接过程，它主要管理：</p>
<ul>
<li>Xcode 中的 projects，记录它们在 Finder 中的引用位置。</li>
<li>一些用户界面的自定义信息（窗口的位置，顺序，偏好等等）。</li>
</ul>
<p>注意到，当你把不同的 projects 放到一个 workspace 中管理后，你仍然可以用 Xcode 单独打开其中的某一个 project，但是如果它涉及到对其它 project target 的依赖，这时候你无法在这个单独的窗口中编译成功。<strong>在大多数情况下project就足够了，除非有特殊情况否则不要使用workspace。事实上，我们总是可以在需要的时候将project嵌入workspace。</strong></p>
<h3 id="Project目录结构策略"><a href="#Project目录结构策略" class="headerlink" title="Project目录结构策略"></a>Project目录结构策略</h3><p>（该部分参考<a href="https://www.zhihu.com/question/26664772/answer/33608947">这个知乎回答</a>）可以先按 <strong>MVC、工具和第三方库</strong> 划分成为顶层目录，再根据各自的特性划分二级甚至三级目录，但一般不超过三级。</p>
<p><strong>ThirdParty</strong> <em>（第三方类 / 库）</em><br>　　|- UMessage<br>　　　　|- UMessage.h<br>　　　　|- …<br>　　|- UMAnalytics<br>　　|- …</p>
<p><strong>Utils</strong> <em>（工具类）</em><br>　　|-Network<em>（网络工具，比如 HTTP、Socket 封装等）</em><br>　　|- UI<em>（UI 工具，封装一些动画等）</em><br>　　　　|- FLUIUtils.h<br>　　　　|- FLUIUtils.m<br>　　　　|- …<br>　　|- …</p>
<p><strong>Models</strong> <em>（模型 M）</em><br>　　|- ModelUtils<em>（仅用于模型的工具）</em><br>　　|- LocalStorage<em>（本地存取封装）</em><br>　　|- ZFSystem<em>（特定功能相关，内容分析等）</em><br>　　　　|- xxx.h<br>　　　　|- xxx.m<br>　　|- MessageBoard<em>（留言板）</em><br>　　|- <em>…</em></p>
<p><strong>ViewControllers</strong> <em>（VC）</em><br>　　|- Login<em>（登录页）</em><br>　　　　|- ZQVCLogin.h<br>　　　　|- ZQVCLogin.m<br>　　　　|- ZQVCLogin.xib<em>（这个 App 写得比较早，所以还在用 xib）</em><br>　　|- User<em>（用户信息页）</em><br>　　|- Library<em>（图书馆功能页）</em><br>　　|- Score<em>（查分页）</em><br>　　|- About<em>（关于页）</em><br>　　|- …</p>
<p><strong>res</strong> <em>（资源）</em><br>　　|- common<em>（通用资源）</em><br>　　　　|- xxx.png<br>　　|- animations<br>　　|- login<br>　　|- …</p>
<h3 id="参考-3"><a href="#参考-3" class="headerlink" title="参考"></a>参考</h3><ul>
<li>[1] <a href="https://zhuanlan.zhihu.com/p/52130048">iOS 开发：深入理解 Xcode 工程结构（一）</a></li>
<li>[2] <a href="https://developer.apple.com/library/archive/featuredarticles/XcodeConcepts/Concept-Targets.html#//apple_ref/doc/uid/TP40009328-CH4-SW1">Xcode Concepts</a></li>
<li>[3] <a href="https://stackoverflow.com/questions/21631313/xcode-project-vs-xcode-workspace-differences">Xcode Project vs. Xcode Workspace - Differences</a></li>
<li>[4] <a href="https://www.zhihu.com/question/26664772/answer/33608947">开发较复杂的 iOS 应用时，在建立清晰易懂的项目目录结构这方面，你有什么好的经验或心得？ </a></li>
</ul>
<h2 id="CMake"><a href="#CMake" class="headerlink" title="CMake"></a>CMake</h2><p>CMake是一个构建系统生成器（build-system generator）。常见的构建系统，有Visual Studio，XCode，Make等等。CMake可以支持不同平台下构建系统的生成。</p>
<p>gcc是GNU Compiler Collection（就是GNU编译器套件），也可以简单认为是编译器，它可以编译很多种编程语言（括C、C++、Objective-C、Fortran、Java等等）。当你的程序只有一个源文件时，直接就可以用gcc命令编译它。但是当你的程序包含很多个源文件时，用gcc命令逐个去编译时，你就很容易混乱而且工作量大所以出现了make工具。</p>
<p>make工具可以看成是一个智能的批处理工具，它本身并没有编译和链接的功能，而是用类似于批处理的方式——通过调用makefile文件中用户指定的命令来进行编译和链接的。makefile是什么？简单的说就像一首歌的乐谱，make工具就像指挥家，指挥家根据乐谱指挥整个乐团怎么样演奏，make工具就根据makefile中的命令进行编译和链接的。makefile命令中就包含了调用gcc（也可以是别的编译器）去编译某个源文件的命令。makefile在一些简单的工程完全可以人工手下，但是当工程非常大的时候，手写makefile也是非常麻烦的，如果换了个平台makefile又要重新修改。这时候就出现了CMake（Cross platform Make）这个工具，cmake就可以更加简单的生成makefile文件给上面那个make用。cmake是个一个开源的跨平台自动化建构系统，用来管理软体建置的程序，并不依赖于某特定编译器，并可支援多层目录、多个应用程式与多个函式库。可是cmake根据什么生成makefile呢？它又要根据一个叫CMakeLists.txt文件（学名：组态档）去生成makefile。CMakeLists.txt文件可以自己手写也可以利用IDE直接生成。</p>
<h3 id="参考-4"><a href="#参考-4" class="headerlink" title="参考"></a>参考</h3><ul>
<li>[1] <a href="https://www.zhihu.com/question/36609459/answer/89743845">GCC 和 cmake的关系？</a></li>
<li>[2] <a href="https://zh.wikipedia.org/zh-hans/CMake">CMake</a></li>
</ul>

      
    </div>
    
    
    


    
      <div>
        
<div class="my_post_copyright">
  <script src="//cdn.bootcss.com/clipboard.js/1.5.10/clipboard.min.js"></script>
  
  <!-- JS库 sweetalert 可修改路径 -->
  <script src="https://cdn.bootcss.com/jquery/2.0.0/jquery.min.js"></script>
  <script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>
  <p><span>本文标题:</span><a href="/2020/07/24/C++大补丸1/">C++大补丸1</a></p>
  <p><span>文章作者:</span><a href="/" title="访问 Huag 的个人博客">Huag</a></p>
  <p><span>发布时间:</span>2020年07月24日 - 17:22</p>
  <p><span>最后更新:</span>2020年08月06日 - 06:45</p>
  <p><span>原始链接:</span><a href="/2020/07/24/C++大补丸1/" title="C++大补丸1">http://huagliu.github.io/2020/07/24/C++大补丸1/</a>
    <span class="copy-path" title="点击复制文章链接"><i class="fa fa-clipboard" data-clipboard-text="http://huagliu.github.io/2020/07/24/C++大补丸1/" aria-label="复制成功！"></i></span>
  </p>
  <p><span>许可协议:</span><i class="fa fa-creative-commons"></i> <a rel="license" href="https://creativecommons.org/licenses/by-nc-nd/4.0/" target="_blank" title="Attribution-NonCommercial-NoDerivatives 4.0 International (CC BY-NC-ND 4.0)">署名-非商业性使用-禁止演绎 4.0 国际</a> 转载请保留原文链接及作者。</p>  
</div>
<script> 
    var clipboard = new Clipboard('.fa-clipboard');
    $(".fa-clipboard").click(function(){
      clipboard.on('success', function(){
        swal({   
          title: "",   
          text: '复制成功',
          icon: "success", 
          showConfirmButton: true
          });
    });
    });  
</script>

      </div>
    

    

    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/C-基础/" rel="tag"><i class="fa fa-tag"></i> C++基础</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2020/07/24/CCGhw-1/" rel="next" title="CCG第一次作业">
                <i class="fa fa-chevron-left"></i> CCG第一次作业
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2020/08/05/C++大补丸2/" rel="prev" title="C++大补丸2">
                C++大补丸2 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          

  
    <div class="comments" id="comments">
      
        <div id="gitment-container"></div>
      
    </div>

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">Huag</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">23</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">10</span>
                  <span class="site-state-item-name">分类</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">26</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          

          

          
          

          
          

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#C-与C语言关系"><span class="nav-number">1.</span> <span class="nav-text">C++与C语言关系</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#发展历史"><span class="nav-number">1.1.</span> <span class="nav-text">发展历史</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#参考"><span class="nav-number">1.2.</span> <span class="nav-text">参考</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#编译过程"><span class="nav-number">2.</span> <span class="nav-text">编译过程</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#源文件（Source-File）"><span class="nav-number">2.1.</span> <span class="nav-text">源文件（Source File）</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#头文件（Head-File）"><span class="nav-number">2.2.</span> <span class="nav-text">头文件（Head File）</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#编译"><span class="nav-number">2.3.</span> <span class="nav-text">编译</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#链接（Link）"><span class="nav-number">2.4.</span> <span class="nav-text">链接（Link）</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#参考-1"><span class="nav-number">2.5.</span> <span class="nav-text">参考</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#GCC-和-LLVM"><span class="nav-number">3.</span> <span class="nav-text">GCC 和 LLVM</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#LLVM"><span class="nav-number">3.1.</span> <span class="nav-text">LLVM</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#GCC"><span class="nav-number">3.2.</span> <span class="nav-text">GCC</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#参考-2"><span class="nav-number">3.3.</span> <span class="nav-text">参考</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Xcode-工程结构"><span class="nav-number">4.</span> <span class="nav-text">Xcode 工程结构</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#工程／项目（Project）"><span class="nav-number">4.1.</span> <span class="nav-text">工程／项目（Project）</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#工程／项目类型"><span class="nav-number">4.2.</span> <span class="nav-text">工程／项目类型</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Scheme、Target、Project-和-Workspace"><span class="nav-number">4.3.</span> <span class="nav-text">Scheme、Target、Project 和 Workspace</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Target"><span class="nav-number">4.3.1.</span> <span class="nav-text">Target</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Scheme"><span class="nav-number">4.3.2.</span> <span class="nav-text">Scheme</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Project"><span class="nav-number">4.3.3.</span> <span class="nav-text">Project</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Workspace"><span class="nav-number">4.3.4.</span> <span class="nav-text">Workspace</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Project目录结构策略"><span class="nav-number">4.4.</span> <span class="nav-text">Project目录结构策略</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#参考-3"><span class="nav-number">4.5.</span> <span class="nav-text">参考</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#CMake"><span class="nav-number">5.</span> <span class="nav-text">CMake</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#参考-4"><span class="nav-number">5.1.</span> <span class="nav-text">参考</span></a></li></ol></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        
<div class="copyright">&copy; <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Huag</span>

  
</div>



  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Muse</a> v5.1.4</div>





  <script src="https://unpkg.com/mermaid@7.1.2/dist/mermaid.min.js"></script>
  <script>
    if (window.mermaid) {
      mermaid.initialize("");
    }
  </script>




        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>

  
    <span class="site-uv">
      <i class="fa fa-user"></i>访客数
      <span class="busuanzi-value" id="busuanzi_value_site_uv"></span>
      人次
    </span>
  

  
</div>








        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  







<!-- LOCAL: You can save these files to your site and update links -->
    
        
        <link rel="stylesheet" href="https://aimingoo.github.io/gitmint/style/default.css">
        <script src="https://aimingoo.github.io/gitmint/dist/gitmint.browser.js"></script>
    
<!-- END LOCAL -->

    

    
      <script type="text/javascript">
      function renderGitment(){
        var gitment = new Gitmint({
            id: window.location.pathname, 
            owner: 'huagliu',
            repo: 'huagliu.github.io',
            
            lang: "" || navigator.language || navigator.systemLanguage || navigator.userLanguage,
            
            oauth: {
            
            
                client_secret: '4cfb710f5ecaef4aac8e993e4f375dc7ce9fcb32',
            
                client_id: '5a3c8be33713b7cf5a11'
            }});
        gitment.render('gitment-container');
      }

      
      renderGitment();
      
      </script>
    







  

  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  

  

  
  

  
  


  

  

</body>
</html>
